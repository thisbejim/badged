{% extends "base.html" %}

{% block content %}
<div class="mdl-grid mdl-grid--hide-phone">
    <div class="divider"></div>
</div>
<div class="mdl-grid">
    <div class="mdl-cell mdl-cell--4-col mdl-cell--hide-phone"></div>
    
    <div class="mdl-cell mdl-cell--12-col-phone mdl-cell--hide-tablet mdl-cell--hide-desktop">
        <div class="mdl-card mdl-shadow--2dp card-wide center">
            <div class="mdl-card__media">
                <img class="center" width="70" height="70" src="{{ url_for('static', filename='badge.png')}}">
            </div>
        
            <div class="mdl-card__supporting-text">
                Sign in with Twitter and your Open Badges email to see if you've earned any badges!
                
                {% if handle != None %}
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label form">
                    <input class="mdl-textfield__input" type="text" name="handle" id="handle" value="{{handle}}"disabled/>
                    
                    <label class="mdl-textfield__label" for="handle">Twitter Handle</label>
                </div>
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label form">
                    <input class="mdl-textfield__input" type="text" name="email" id="email" />
                    <label class="mdl-textfield__label" for="email">Mozilla Backpack Email</label>
                </div>
                {% else %}
                {% endif %}
                
            </div>
            <div class="mdl-card__actions mdl-card--border">
                {% if handle != None %}
                <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" onclick="check()">
                    Badge Me!
                </a>
                <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect align-right" href="/logout">
                    Logout
                </a>
                {% else %}
                <a href="/twitter" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect center" >
                    Sign in with Twitter
                </a>
                {% endif %}
            </div>
            <div class="mdl-card__menu">
                <button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect">
                    <i class="material-icons">share</i>
                </button>
            </div>
            <div id="p2" class="mdl-progress mdl-js-progress mdl-progress__indeterminate progress-demo progress"></div>
        </div>
    </div>
    
    <div class="mdl-cell mdl-cell--4-col mdl-cell--hide-phone mdl-cell--12-col-phone">
        <div class="mdl-card mdl-shadow--2dp card-wide center">
            <div class="mdl-card__media">
                <img class="center" src="{{ url_for('static', filename='badge.png')}}">
            </div>
        
            <div class="mdl-card__supporting-text">
                Sign in with Twitter and your Open Badges email to see if you've earned any badges!
                
                {% if handle != None %}
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label form">
                    <input class="mdl-textfield__input" type="text" name="handle" id="handle" value="{{handle}}"disabled/>
                    
                    <label class="mdl-textfield__label" for="handle">Twitter Handle</label>
                </div>
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label form">
                    <input class="mdl-textfield__input" type="text" name="email" id="email" />
                    <label class="mdl-textfield__label" for="email">Mozilla Backpack Email</label>
                </div>
                {% else %}
                {% endif %}
                
            </div>
            <div class="mdl-card__actions mdl-card--border">
                {% if handle != None %}
                <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" onclick="check()">
                    Badge Me!
                </a>
                <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect align-right" href="/logout">
                    Logout
                </a>
                {% else %}
                <a href="/twitter" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect center" >
                    Sign in with Twitter
                </a>
                {% endif %}
            </div>
            <div class="mdl-card__menu">
                <button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect">
                    <i class="material-icons">share</i>
                </button>
            </div>
            <div id="progress-bar" class="mdl-progress mdl-js-progress mdl-progress__indeterminate progress-demo progress"></div>
        </div>
    </div>
    <div class="mdl-cell mdl-cell--4-col"></div>
</div>

<script>

function check() {
    document.getElementById('progress-bar').style.display='block';
	xmlhttp=new XMLHttpRequest();
	xmlhttp.open("POST","/check",true);
	xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
    xmlhttp.send('email='+document.getElementById('email').value+'&handle='+document.getElementById('handle').value);

    xmlhttp.onreadystatechange=function(){
        document.getElementById('progress-bar').style.display='none';
        if (xmlhttp.readyState==4 && xmlhttp.status==200){
        console.log(xmlhttp.responseText);
        window.location.href = '/award';
    }
  }
}
</script>

{% endblock %}

